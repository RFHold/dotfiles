#! /bin/bash

if [[ "$OSTYPE" == "darwin"* ]]; then
  # macOS
  if ! command -v brew &> /dev/null; then
    echo "Homebrew not found. Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  fi
  echo "Installing Ansible with Homebrew..."
  brew install ansible
elif [[ -f /etc/debian_version ]]; then
  # Debian/Ubuntu
  echo "Updating package list..."
  sudo apt update
  echo "Installing Ansible..."
  sudo apt install -y ansible
else
  echo "Unsupported OS"
  exit 1
fi

# Check if dotfiles repo is cloned

if [ -d "$HOME/dotfiles" ]; then
  echo "Dotfiles repo found"
else
  echo "Cloning dotfiles repo..."
  git clone --recursive https://gitlab.com/rfhold/dotfiles
fi

ansible-playbook ~/dotfiles/playbooks/setup-dev-machine.yaml
